<div id="awsec2-setup" class="section level2">
<h2>AWS/EC2 Setup</h2>
<ul>
	<li>Step 1- Amazon Machine Instance: <strong>Ubuntu</strong></li>
	<li>Step 2 - Instance Type: <strong>m4.large</strong></li>
	<li>Step 3 - No changes</li>
	<li>Step 4 - Storage: <strong>30 Size GiB</strong></li>
	<li>Step 5 - No changes</li>
	<li>Step 6 - Security Group Name: <strong>Shiny</strong>Click Add Rule, select Type: <strong>All Trafic</strong> | Source: <strong>My IP</strong><strong>Optional: If you want to open your Shiny server to the world</strong> - Click Add Rule, select Type: <strong>Custom TCP Rule</strong> | Port Range: <strong>3838</strong> |Source: <strong>Anywhere</strong><strong>Optional: If you plan to have to publish apps from a RStudio server within the local network (VPC)</strong> - Click Add Rule, select Type: <strong>All Traffic</strong> | Source: <strong>Custom</strong> and <strong>type the the first two numbers in the IP address followed by ‘.0.0/16’</strong> (So,if your Shiny server’s internal IP address is 172.31.2.200 then you’d enter 172.31.0.0/16 This gives every server in your VPC access to your Shiny server and to each other)</li>
	<li>After clicking <strong>Launch</strong> the <strong>“Select existing pair or create a new pair”</strong> screen will appear, select:Create a new pairKey pair name: <strong>shiny</strong>Click <strong>Download Key Pair</strong>

Save the file

Click <strong>Launch Instances</strong></li>
	<li>Go to the <strong>Instances</strong> section in the <strong>EC2 Dashboard</strong> section and click on the new instance</li>
	<li>Copy the <strong>Public DNS</strong> address, from here on we’ll refer to it as <strong>MY_PUBLIC_DNS</strong></li>
</ul>
<div id="key-and-connection-setup-from-laptop" class="section level3">
<h3>Key and Connection setup from laptop</h3>
AWS provides the step-by-step instructions for this part:
<ul>
	<li>Windows - <a class="uri" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html</a>Complete sections <strong>Converting Your Private Key Using PuTTYgen</strong> and <strong>Starting a PuTTY Session</strong></li>
	<li>Non-Windows - <a class="uri" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html</a>Only go through the instructions in the <strong>To connect to your instance using SSH</strong> section</li>
</ul>
</div>
</div>
<div id="shiny-server-configuration" class="section level2">
<h2>Shiny server configuration</h2>
<div id="install-r" class="section level3">
<h3>Install R</h3>
We need to update the package list so that Ubuntu installs the latest R version. Here is the reference: <a class="uri" href="https://cran.r-project.org/bin/linux/ubuntu/">https://cran.r-project.org/bin/linux/ubuntu/</a>

<strong>Tip</strong> The terminal commands inside the boxes can be copied and pasted into your terminal session. In <strong>putty</strong> you can use right-click as the “paste” command.
<pre><code>sudo sh -c 'echo "deb http://cran.rstudio.com/bin/linux/ubuntu trusty/" >> /etc/apt/sources.list'
gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
gpg -a --export E084DAB9 | sudo apt-key add -
sudo apt-get update
sudo apt-get install r-base</code></pre>
</div>
<div id="install-shiny" class="section level3">
<h3>Install Shiny</h3>
The steps below install the current version. To find updated instructions navigate to: <a class="uri" href="https://www.rstudio.com/products/shiny/download-server/">https://www.rstudio.com/products/shiny/download-server/</a> and select <strong>Ubuntu 12.04 or later</strong>
<pre><code>sudo su - -c "R -e \"install.packages('shiny', repos='https://cran.rstudio.com/')\""
sudo apt-get install gdebi-core
wget https://download3.rstudio.org/ubuntu-12.04/x86_64/shiny-server-1.4.4.801-amd64.deb
sudo gdebi shiny-server-1.4.4.801-amd64.deb</code></pre>
</div>
<div id="install-rstudio" class="section level3">
<h3>Install RStudio</h3>
<strong>Why install RStudio?</strong> I’m using RStudio to upload and test my apps along with any other supporting files. This removes the need to setup complicated security and FTP.

The steps below install the current version. To find updated instructions navigate to: <a class="uri" href="https://www.rstudio.com/products/rstudio/download-server/">https://www.rstudio.com/products/rstudio/download-server/</a> and select <strong>Debian/Ubuntu</strong>
<pre><code>wget https://download2.rstudio.org/rstudio-server-0.99.903-amd64.deb
sudo gdebi rstudio-server-0.99.903-amd64.deb</code></pre>
We need to add a default user that can log on RStudio. I’m going to use ‘rstudio’ as the name but it can be whatever you’d like. The second command give the user ‘sudo’ (read Admin) access to the server. The third line is key, it makes it where you don’t have to type ‘sudo’ before any file/folder command. This command makes it possible for RStudio to create new folders and files in the Shiny server.
<pre><code>sudo adduser rstudio
sudo usermod -aG sudo rstudio
sudo chown rstudio /srv/shiny-server/</code></pre>
type <strong>rstudio</strong> as the password

</div>
<div id="pre-install-needed-packages" class="section level3">
<h3>Pre-install needed packages</h3>
<strong>Any package that an ‘Shiny App’ uses will need to be pre-installed, or the will crash</strong>. Here are a few we will load before we start using the server. If you need any other package, just follow the instruction pattern, replacing the name of the desired package.

You can always install more packages later via a terminal session
<pre><code>sudo su - -c "R -e \"install.packages('rmarkdown', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('ggvis', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('ggplot2', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('compat-gmp4', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('compat-libffi5', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('data.table', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('ggplot2', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('stats', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('plyr', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('maps', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('stringr', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('mapproj', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('ggExtra', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('ggthemes', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('stats', repos='http://cran.us.r-project.org')\""
sudo su - -c "R -e \"install.packages('flexdashboard', repos='http://cran.us.r-project.org')\""</code></pre>
</div>
<div id="test-server-connnectivity" class="section level3">
<h3>Test server connnectivity</h3>
<ul>
	<li>To confirm the <strong>Shiny</strong> server is working go to: <a class="uri" href="http://MY_PUBLIC_DNS:3838/">http://MY_PUBLIC_DNS:3838/</a></li>
	<li>To confirm the <strong>RStudio</strong> server is working go to: <a class="uri" href="http://MY_PUBLIC_DNS:8787/">http://MY_PUBLIC_DNS:8787/</a></li>
</ul>
</div>
</div>
<div id="publishing-apps" class="section level2">
<h2>Publishing apps</h2>
<div id="publishing-from-a-laptop" class="section level3">
<h3>Publishing from a laptop</h3>
<ul>
	<li>Navigate to the RStudio server and log on as ‘rstudio’</li>
	<li>Confirm that the latest version of R is loaded (As of today is 3.3.1)</li>
	<li>Click <strong>File</strong> - <strong>New File</strong> - <strong>Shiny Web App</strong></li>
	<li>Application Name: my_test</li>
	<li>Click <strong>Browse</strong></li>
	<li>Click on the <strong>Go to directory</strong> button, identified as […]</li>
	<li>Type the following (exactly as is in here): <strong>/srv/shiny-server/</strong></li>
	<li>Click <strong>Choose</strong> and then click <strong>Create</strong></li>
	<li>Navigate to your new app by going to: <a class="uri" href="http://MY_PUBLIC_DNS:3838/my_test">http://MY_PUBLIC_DNS:3838/my_test</a></li>
</ul>
</div>
<div id="publishing-from-a-rstudio-server-in-the-local-network" class="section level3">
<h3>Publishing from a RStudio server in the local network</h3>
The following method sets up a single user in the RStudio server to have ‘write’ access in the Shiny server. Using Samba, we will create a shared folder inside the RStudio server user that maps directly to the Shiny server <strong>shiny-server</strong> folder. In order for RStudio to create folders and files, a specific user needs to logged on in the RStudio server. This is why we are not putting the ‘shiny-server’ mount point in a more generic location. For purposes of this document, I’ll use <strong>shiny-user</strong> as the user.

The assumption is made that the ‘client’ RStudio server is running an Ubuntu (Debian) distribution.

<strong>Make sure to perform the second optional security setting in the ‘AWS/EC2 Setup’ section</strong>

The plan is to:
<ol>
	<li>Create a user in the Shiny and RStudio server with the same name and password</li>
	<li>Install and configure the Samba server in the Shiny server</li>
	<li>Install and configure the Samba client in the RStudio server</li>
	<li>Point the ‘shiny-server’ folder to a local folder in the RStudio server’s user</li>
</ol>
<div id="in-the-shiny-server" class="section level4">
<h4>In the Shiny server</h4>
<ul>
	<li>Open a new terminal session in the Shiny Server</li>
	<li>We’ll create the new user, give it ‘admin’ access and then we remove the need for it to use the ‘sudo’ command
<pre><code>sudo adduser shiny-user
sudo usermod -aG sudo shiny-user
sudo chown shiny-user /srv/shiny-server/
sudo chgrp sudo /srv/shiny-server/</code></pre>
</li>
	<li>Installing and configuring Samba
<pre><code>sudo apt-get install samba
sudo smbpasswd -a shiny-user [typed password twice]
sudo nano /etc/samba/smb.conf</code></pre>
</li>
	<li>Add the following lines at the end of the file:
<pre><code>[shiny-server]
comment = Shiny Server Share
path=/srv/shiny-server/
browsable = yes
valid users = shiny-user
read only = no</code></pre>
</li>
	<li>Close the file by typing <strong>CRTL+X</strong>, then <strong>Y</strong> and enter</li>
	<li>Restarting the Samba server
<pre><code>sudo service smbd restart</code></pre>
</li>
</ul>
</div>
<div id="in-the-rstudio-server" class="section level4">
<h4>In the RStudio server</h4>
<ul>
	<li>Start a terminal session in the ‘client’ <strong>RStudio Server</strong></li>
	<li>Create the new user
<pre><code>sudo adduser shiny-user</code></pre>
</li>
	<li>In a web browser, navigate to the RStudio server and log on as ‘shiny-user’</li>
	<li>Create a folder called <strong>shiny-server</strong></li>
	<li>Switch back to the terminal session in the RStudio server</li>
	<li>We’ll install and configure the Samba client
<pre><code>sudo apt-get install cifs-utils
sudo nano /etc/fstab</code></pre>
</li>
	<li>Add the following lines at the end of the file:
<pre><code>//[ Shiny server's Internal IP Address]/shiny-server  /home/shiny-user/shiny-server  cifs  username=shiny-user,password=shiny-user</code></pre>
</li>
	<li>Close the file by typing <strong>CRTL+X</strong>, then <strong>Y</strong> and enter</li>
	<li>‘Mount’ the share, which means that the internal folder now points to the folder in the external Shiny server
<pre><code>sudo mount -a</code></pre>
</li>
	<li>Go back to the web browser that has the RStudio session</li>
	<li>Click on the ‘shiny-server’ folder</li>
	<li>To confirm that the permissions are correct, create a new Shiny app, called <strong>server_test</strong> in the <strong>shiny-server</strong> folder</li>
	<li>Navigate to your new app by going to: <a class="uri" href="http://MY_PUBLIC_DNS:3838/server_test">http://MY_PUBLIC_DNS:3838/server_test</a></li>
</ul>
</div>
</div>
</div>
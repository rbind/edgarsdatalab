---
title: "Shiny Server in AWS"
date: 2016-08-25
categories: ["R"]
tags: ["Shiny", "AWS", "EC2"]
---



<div id="awsec2-setup" class="section level2">
<h2>AWS/EC2 Setup</h2>
<ol style="list-style-type: decimal">
<li><strong>Amazon Machine Instance:</strong> Ubuntu</li>
<li><strong>Instance Type:</strong> m4.large</li>
<li>No changes</li>
<li><strong>Storage:</strong> 30 Size GiB</li>
<li>No changes</li>
<li>Security Group Name: Shiny</li>
</ol>
<ul>
<li>Click Add Rule, select Type: All Trafic | Source: My IPOptional: If you want to open your Shiny server to the world – Click Add Rule, select Type: Custom TCP Rule | Port Range: 3838 |Source: Anywhere</li>
<li>Optional: If you plan to have to publish apps from a RStudio server within the local network (VPC) – Click Add Rule, select Type: All Traffic | Source: Custom and type the the first two numbers in the IP address followed by ‘.0.0/16’ (So,if your Shiny server’s internal IP address is 172.31.2.200 then you’d enter 172.31.0.0/16 This gives every server in your VPC access to your Shiny server and to each other)</li>
</ul>
<p>After clicking Launch the “Select existing pair or create a new pair” screen will appear, select:Create a new pairKey pair name: shiny Click Download Key Pair</p>
<p>Save the file</p>
<p>Click Launch Instances</p>
<p>Go to the Instances section in the EC2 Dashboard section and click on the new instance Copy the Public DNS address, from here on we’ll refer to it as MY_PUBLIC_DNS</p>
<div id="key-and-connection-setup-from-laptop" class="section level3">
<h3>Key and Connection setup from laptop</h3>
<p>AWS provides the step-by-step instructions for this part:</p>
<p><strong>Windows</strong> – <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.htmlComplete" class="uri">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.htmlComplete</a> sections Converting Your Private Key Using PuTTYgen and Starting a PuTTY Session</p>
<p><strong>Non-Windows</strong> – <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.htmlOnly" class="uri">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.htmlOnly</a> go through the instructions in the To connect to your instance using SSH section Shiny server configuration</p>
</div>
</div>
<div id="install-r" class="section level2">
<h2>Install R</h2>
<p>We need to update the package list so that Ubuntu installs the latest R version. Here is the reference: <a href="https://cran.r-project.org/bin/linux/ubuntu/" class="uri">https://cran.r-project.org/bin/linux/ubuntu/</a></p>
<p><strong>Tip: </strong> The terminal commands inside the boxes can be copied and pasted into your terminal session. In putty you can use right-click as the “paste” command.</p>
<pre class="bash"><code>sudo sh -c &#39;echo &quot;deb http://cran.rstudio.com/bin/linux/ubuntu xenial/&quot; &gt;&gt; /etc/apt/sources.list&#39;
gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
gpg -a --export E084DAB9 | sudo apt-key add -
sudo apt-get update
sudo apt-get install r-base</code></pre>
</div>
<div id="install-shiny" class="section level2">
<h2>Install Shiny</h2>
<p>The steps below install the current version. To find updated instructions navigate to: <a href="https://www.rstudio.com/products/shiny/download-server/" class="uri">https://www.rstudio.com/products/shiny/download-server/</a> and select Ubuntu 12.04 or later</p>
<pre class="bash"><code>sudo su - -c &quot;R -e \&quot;install.packages(&#39;shiny&#39;, repos=&#39;https://cran.rstudio.com/&#39;)\&quot;&quot;
sudo apt-get install gdebi-core
wget https://download3.rstudio.org/ubuntu-12.04/x86_64/shiny-server-1.4.4.801-amd64.deb
sudo gdebi shiny-server-1.4.4.801-amd64.deb
</code></pre>
</div>
<div id="install-rstudio" class="section level2">
<h2>Install RStudio</h2>
<p><strong>Why install RStudio Server along the Shiny Server?</strong> I’m using RStudio to upload and test my apps along with any other supporting files. This removes the need to setup complicated security and FTP.</p>
<p>The steps below install the current version. To find updated instructions navigate to: <a href="https://www.rstudio.com/products/rstudio/download-server/" class="uri">https://www.rstudio.com/products/rstudio/download-server/</a> and select <strong>Debian/Ubuntu</strong></p>
<pre class="bash"><code>wget https://download2.rstudio.org/rstudio-server-0.99.903-amd64.deb
sudo gdebi rstudio-server-0.99.903-amd64.deb</code></pre>
<p>We need to add a default user that can log on RStudio. I’m going to use ‘rstudio’ as the name but it can be whatever you’d like. The second command give the user ‘sudo’ (read Admin) access to the server. The third line is key, it makes it where you don’t have to type ‘sudo’ before any file/folder command. This command makes it possible for RStudio to create new folders and files in the Shiny server.</p>
<pre class="bash"><code>sudo adduser rstudio
sudo usermod -aG sudo rstudio
sudo chown rstudio /srv/shiny-server/
## select and type a password</code></pre>
</div>
<div id="pre-install-r-packages" class="section level2">
<h2>Pre-install R packages</h2>
<p>Any package that an ‘Shiny App’ uses will need to be pre-installed, or the will crash. Here are a few we will load before we start using the server. If you need any other package, just follow the instruction pattern, replacing the name of the desired package.</p>
<p>You can always install more packages later via a terminal session</p>
<pre class="bash"><code>sudo su - -c &quot;R -e \&quot;install.packages(&#39;rmarkdown&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;ggvis&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;ggplot2&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;compat-gmp4&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;compat-libffi5&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;ggplot2&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;stats&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;plyr&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;maps&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;stringr&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;mapproj&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;ggExtra&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;ggthemes&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;stats&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;
sudo su - -c &quot;R -e \&quot;install.packages(&#39;flexdashboard&#39;, repos=&#39;http://cran.us.r-project.org&#39;)\&quot;&quot;</code></pre>
<div id="test-server-connnectivity" class="section level3">
<h3>Test server connnectivity</h3>
<p>To confirm the Shiny server is working go to: <a href="http://MY_PUBLIC_DNS:3838/" class="uri">http://MY_PUBLIC_DNS:3838/</a> To confirm the RStudio server is working go to: <a href="http://MY_PUBLIC_DNS:8787/" class="uri">http://MY_PUBLIC_DNS:8787/</a></p>
</div>
</div>
<div id="publishing-apps" class="section level2">
<h2>Publishing apps</h2>
<div id="publishing-from-within-the-rstudio-server" class="section level3">
<h3>Publishing from within the RStudio Server</h3>
<ol style="list-style-type: decimal">
<li>Navigate to the RStudio server: <a href="http://MY_PUBLIC_DNS:8787/" class="uri">http://MY_PUBLIC_DNS:8787/</a></li>
<li>Log on as ‘<em>rstudio</em>’</li>
<li>Confirm that the latest version of R is loaded (As of today is 3.4.2)</li>
<li>Click File – New File – Shiny Web App</li>
<li>Application Name: my_test</li>
<li>Click Browse</li>
<li>Click on the Go to directory button, identified as […]</li>
<li>Type the following (exactly as is in here): /srv/shiny-server/</li>
<li>Click Choose and then click Create</li>
<li>Navigate to your new app by going to: <a href="http://MY_PUBLIC_DNS:3838/my_test" class="uri">http://MY_PUBLIC_DNS:3838/my_test</a></li>
</ol>
</div>
<div id="publishing-from-an-rstudio-server-in-the-local-network" class="section level3">
<h3>Publishing from an RStudio server in the local network</h3>
<p>The following method sets up a single user in the RStudio server to have ‘write’ access in the Shiny server. Using Samba, we will create a shared folder inside the RStudio server user that maps directly to the Shiny server shiny-server folder. In order for RStudio to create folders and files, a specific user needs to logged on in the RStudio server. This is why we are not putting the ‘shiny-server’ mount point in a more generic location. For purposes of this document, I’ll use shiny-user as the user.</p>
<p>The assumption is made that the ‘client’ RStudio server is running an Ubuntu (Debian) distribution.</p>
<p>Make sure to perform the second optional security setting in the ‘AWS/EC2 Setup’ section</p>
<p>The plan is to:</p>
<ol style="list-style-type: decimal">
<li>Create a user in the Shiny and RStudio server with the same name and password</li>
<li>Install and configure the Samba server in the Shiny server</li>
<li>Install and configure the Samba client in the RStudio server</li>
<li>Point the ‘shiny-server’ folder to a local folder in the RStudio server’s user</li>
</ol>
<p>In the Shiny server</p>
<ul>
<li>Open a new terminal session in the Shiny Server</li>
<li><p>We’ll create the new user, give it ‘admin’ access and then we remove the need for it to use the ‘sudo’ command</p>
<pre class="bash"><code>sudo adduser shiny-user
sudo usermod -aG sudo shiny-user
sudo chown shiny-user /srv/shiny-server/
sudo chgrp sudo /srv/shiny-server/</code></pre>
<p>Installing and configuring Samba</p>
<pre class="bash"><code>sudo apt-get install samba
sudo smbpasswd -a shiny-user [typed password twice]
sudo nano /etc/samba/smb.conf</code></pre></li>
<li><p>Add the following lines at the end of the file:</p>
<pre class="bash"><code>[shiny-server]
comment = Shiny Server Share
path=/srv/shiny-server/
browsable = yes
valid users = shiny-user
read only = no</code></pre></li>
<li>Close the file by typing CRTL+X, then Y and enter</li>
<li><p>Restarting the Samba server</p>
<pre class="bash"><code>sudo service smbd restart</code></pre></li>
<li>In the RStudio server</li>
<li>Start a terminal session in the ‘client’ RStudio Server</li>
<li><p>Create the new user</p>
<pre class="bash"><code>sudo adduser shiny-user</code></pre></li>
<li>In a web browser, navigate to the RStudio server and log on as ‘shiny-user’</li>
<li>Create a folder called shiny-server</li>
<li>Switch back to the terminal session in the RStudio server</li>
<li><p>We’ll install and configure the Samba client</p>
<pre class="bash"><code>sudo apt-get install cifs-utils
sudo nano /etc/fstab</code></pre></li>
<li><p>Add the following lines at the end of the file:</p>
<pre class="bash"><code>//[ Shiny server&#39;s Internal IP Address]/shiny-server  /home/shiny-user/shiny-server  cifs  username=shiny-user,password=shiny-user</code></pre></li>
<li>Close the file by typing CRTL+X, then Y and enter</li>
<li>‘Mount’ the share, which means that the internal folder now points to the folder in the external Shiny server sudo mount -a</li>
<li>Go back to the web browser that has the RStudio session</li>
<li>Click on the ‘shiny-server’ folder</li>
<li>To confirm that the permissions are correct, create a new Shiny app, called server_test in the shiny-server folder</li>
<li><p>Navigate to your new app by going to: <a href="http://MY_PUBLIC_DNS:3838/server_test" class="uri">http://MY_PUBLIC_DNS:3838/server_test</a></p></li>
</ul>
</div>
</div>
